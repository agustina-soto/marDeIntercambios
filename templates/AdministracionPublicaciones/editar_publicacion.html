<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Publicación</title>

    <!-- Estilos CSS -->
    <style>
        .error-message { color: red; }
        .messages { list-style-type: none; padding: 0; }
        .messages li { margin-bottom: 10px; color: green; }
        form { display: flex; flex-direction: column; max-width: 400px; margin: 0 auto; }
        form div { margin-bottom: 15px; }
        button { padding: 10px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #45a049; }
        .custom-file-input { display: none; }
        .custom-file-label { display: inline-block; padding: 7px 10px; background-color: #f8f8f8; border: 1px solid #ccc; cursor: pointer; }
        .custom-file-label:hover { background-color: #AAAAAA; }
        .file-preview { font-size: 14px; margin-top: 5px; }
        .photo-container { display: flex; align-items: center; margin-bottom: 10px; }
        .photo-container img { width: 100px; height: auto; margin-right: 10px; }
        .photo-container .file-name { width: auto; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .photo-container button { background-color: #f44336; }
        .custom-file-upload { padding: 4px 8px; background-color: #ddd; color: #666; border: 1px solid #ccc; cursor: pointer; display: inline-block; border-radius: 0px; font-size: 16px; }
        .custom-file-upload:hover { background-color: #ccc; }
        
        /* Estilos para el botón "x" que elimina la seleccion de una foto */
        .eliminar-foto {
            display: inline-flex; /* Cambia la visualización a flex para centrar verticalmente */
            justify-content: center; /* Centra horizontalmente */
            align-items: center; /* Centra verticalmente */
            width: 20px;
            height: 20px;
            line-height: 20px;
            text-align: center;
            background-color: #ccc;
            color: #666;
            border-radius: 50%;
            cursor: pointer;
            margin-left: 10px;
            /* Elimina el color verde del botón */
            background-color: #f8f8f8;
            color: #ccc;
            border: 1px solid #ccc;
        }
        .eliminar-foto:hover {
            /* Cambia el color de fondo al pasar el mouse */
            background-color: #aaa;
            color: #fff;
        }

        .file-list li {
            font-size: 16px; /* Cambia el tamaño de la fuente según tus preferencias */
            list-style-type: none; /* Elimina el punto de listado */
            margin-left: 0; /* Elimina cualquier margen izquierdo que pueda tener el elemento */
        }
        
    </style>
</head>
<body>
    <!-- Encabezado -->
    <h1>Editar Publicación</h1>

    <!-- Muestra mensajes de éxito o error -->
    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li>{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    <!-- Mostrar errores de formulario -->
    {% if publicacion_form.errors %}
    <div class="error-message">
        <p>Corrige los siguientes errores:</p>
        <ul>
            {% for field, error_list in publicacion_form.errors.items %}
                {% for error in error_list %}
                    <li>{{ error }}</li>
                {% endfor %}
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <!-- Formulario de edición -->
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        
        <!-- Campo Título -->
        <div>
            {{ publicacion_form.titulo.label_tag }}
            {{ publicacion_form.titulo }}
            <span class="error-message">{{ publicacion_form.titulo.errors }}</span>
        </div>

        <!-- Campo Precio Minimo -->
        <div>
            {{ publicacion_form.precio_minimo.label_tag }}
            {{ publicacion_form.precio_minimo }}
            <span class="error-message">{{ publicacion_form.precio_minimo.errors }}</span>
        </div>

        <!-- Campo tipo_embarcacion -->
        <div>
            {{ publicacion_form.tipo_embarcacion.label_tag }}
            {{ publicacion_form.tipo_embarcacion }}
            <span class="error-message">{{ publicacion_form.tipo_embarcacion.errors }}</span>
        </div>

        <!-- Campo anio -->
        <div>
            {{ publicacion_form.anio.label_tag }}
            {{ publicacion_form.anio }}
            <span class="error-message">{{ publicacion_form.anio.errors }}</span>
        </div>


        <!-- Campo para Subir Fotos -->
        <div>
            <!-- Etiqueta para el campo de selección de archivos -->
            <label>Fotos:</label>
            <!-- Etiqueta personalizada para el botón de selección de archivos -->
            <label for="custom-file" class="custom-file-label">Elegir archivos</label>
            <!-- Campo de entrada para seleccionar archivos. Permite seleccionar múltiples archivos -->
            <input type="file" id="custom-file" class="custom-file-input" name="foto" multiple onchange="updateFileList(this)">
            <!-- Muestra mensajes de error relacionados con la subida de fotos -->
            <span class="error-message">{{ foto_form.foto.errors }}</span>
            <!-- Contenedor para la previsualización de archivos seleccionados -->
            <div id="file-preview" class="file-preview"></div>
        </div>

        <!-- Itera sobre las fotos ya existentes en la publicación -->
        {% for foto in fotos_publicacion %}
        <!-- Contenedor para cada foto existente -->
        <div class="photo-container" data-id="{{ foto.id }}">
            <!-- Muestra la imagen de la foto existente -->
            <img src="{{ foto.foto.url }}" alt="Foto">
            <!-- Botón para eliminar la foto -->
            <span class="eliminar-foto" onclick="eliminarFoto(this.parentNode)">x</span>
        </div>
        {% endfor %}

        <!-- Campo oculto para almacenar las IDs de las fotos a eliminar -->
        <input type="hidden" id="fotos-a-eliminar" name="fotos_a_eliminar">

        <!-- Botón para guardar los cambios -->
        <button type="submit">Guardar Cambios</button>
</body>
</html>